{% extends 'base.html' %}

{% block navbar %}
    <ul class="navbar-nav mt-3">
      <li class="navbar-item"><a class="navbar-brand ms-2 me-2" style="color: FFFFFF; text-decoration: none;">This is Branding</a></li>
      <li class="navbar-item"><a class="me-2" style="color: F8F9FA; text-decoration: none;" href="{% url 'dashboard' %}">Dashboard (current)</a></li>
      <li class="navbar-item"><a class="me-2" style="color: ADB5BD; text-decoration: none;" href="{% url 'view_members' %}">Members</a></li>
      <li class="navbar-item"><a class="me-2" style="color: ADB5BD; text-decoration: none;" href="{% url 'view_project' %}">Overview</a></li>
      <!-- TODO: Logout -->
      <li><a class="mr-2" style="color: ADB5BD; text-decoration: none;" href="">Logout</a></li>
    </ul>
{% endblock %}

{% block content %}
    <h1 class="ms-3" style="color: WHITE;">{{ project.project_name }}</h1>
    <!-- Resolve the issue of scrolling too far and casuing it to stay, add a function which tracks how far away from the start tihs is and moves with it -->
    <div style="position: absolute; left: 48%; border-right: solid 1px white; height:100%;"></div>
    <div class="mb-3" style="height: 1px; background-color: #EAEFF5"></div>
    <!-- line break -->

    <!-- Tasks list -->
    <div id="tasksList">
      <h2 class="ms-3"style="color: WHITE">
        Tasks
        <button id="tasksCreateBtn" class="rounded-5 overflow-hidden" style="width: 24px; height: 24px; text-align: center;" onclick="toggleForm('tasks')"></button>
      </h2>
      <div class="mb-3 ms-3" style="height: 1px; width: 91%; background-color: #EAEFF5"></div>
        <!-- line break --> 
      {% for task in tasks %}
      <table id="taskTable{{forloop.counter}}" class="table ms-3 rounded-3 overflow-hidden" style="width: 91%;" onload="colorTable()">  

        <script 
          defer 
          data-task-status = "{{ task.get_task_status_display}}">
          var table = document.getElementById("taskTable{{forloop.counter}}");
          var data = document.currentScript.dataset;
          var task_status = data.taskStatus;
          switch(task_status){
            case "In Progress":
              table.classList.add("table-success");
              break;
            case "For Review":
              table.classList.add("table-warning");
              break;
            case "Completed":
              table.classList.add("table-danger");
              break;
          }
        </script>

          <tr>
            <td><h5>{{ task.task_name }}</h5></td>                 
            <td class="table table-light p-0" style="width:80%">
              <table style="text-align: left;" class="table table-light mb-0">
                <tr>
                  <td><i>Status:</i> <b>{{ task.get_task_status_display }}</b></td>
                </tr>
                <tr>
                  <td><i>Priority:</i> <b>{{ task.get_task_priority_display }}</b></td>
                </tr>
                <tr>
                  <td><i>Notes:</i> {{ task.task_notes|linebreaks }}</td>
                </tr>
                <tr class="removeBottomBorder">
                  <td class="removeBottomBorder"><i>Deadline:</i> <b>{{ task.task_deadline }}</b></td>
                </tr>
              </table>
            </td>
          </tr>
      </table>
      {% endfor %}
    </div>

    <!-- New task form -->
    <div id="tasksForm">
      <h2 style="color: WHITE">Create Task</h2>
      <div class="mb-3" style="height: 1px; width: 93%; background-color: #EAEFF5"></div>
      <!-- line break --> 
      <form action="{% url 'create_task' %}" method="POST">{% csrf_token %}
        <div class="row">
          <label style="color: WHITE; font-size: 26px;" for="task_name">Task Name:</label>
        </div>
        <div class="row">
          <input class="form-control mt-2 ms-2 rounded-3 overflow-hidden" style="width: 90%" type="text" name="task_name" id="task_name" required><br><br>
        </div>

        <div class="row">
          <label style="color: WHITE; font-size: 26px;"for="task_notes">Task Notes:</label>
        </div>
        <div class="row">
          <textarea class="form-label mt-2 ms-2 rounded-4 overflow-hidden" style="width: 90%; resize: none;" name="task_notes" id="task_notes" cols="30" rows="10"></textarea><br><br>
        </div>

        <label style="color: WHITE; font-size: 26px;">Task Priority:</label>
        
        <input class="mt-3" type="radio" id="task_priority_l" name="task_priority" value="L" required>
        <label style="color: WHITE;" for="task_priority_l">Low</label>
        <input class="mt-3" type="radio" id="task_priority_m" name="task_priority" value="M" required>
        <label style="color: WHITE;" for="task_priority_m">Medium</label>
        <input class="mt-3" type="radio" id="task_priority_h" name="task_priority" value="H" required>
        <label style="color: WHITE;" for="task_priority_h">High</label>
        <br><br>


        <label style="color:WHITE; font-size: 26px;" for="task_deadline">Deadline:</label>
        <input class="rounded-3 overflow-hidden" style="width:93%;"type="date" name="task_deadline" id="task_deadline"><br><br>

        <!-- TODO: Task Members-->
        <label style="color: WHITE; font-size: 26px;" for="task_members">Task Members:</label>
        <br><br>
        <div class="col">
          <button class="btn btn-light me-3" onclick="toggleForm('tasks')">Cancel</button>
          <input class="btn me-3" style="background-color: BLACK; color:WHITE;" type="submit">
        </div>
      </form>
    </div>

    <!-- New expense form -->
    <div id="expensesForm">
      <div class="ms-3">
        <h2 style="color: WHITE;">New Expense</h2>
        <div class="mb-3" style="height: 1px; width: 93%; background-color: #EAEFF5"></div>
        <!-- line break --> 
        <form action="{% url 'create_expense' %}" method="POST">{% csrf_token %}
          <div class="row">
            <label style="color: WHITE; font-size: 26px;" for="expense_date">Expense date:</label>
          </div>
          <div class="row">
            <input class="rounded-3 overflow-hidden mt-2 ms-2" style="width:90%;" type="date" name="expense_date" id="expense_date" required><br><br>
          </div>
          <div class="row">
            <label style="color: WHITE; font-size: 26px;" for="expense_desc">Expense Description:</label>
          </div>
          <div class="row">
            <textarea class="rounded-4 overflow-hidden mt-2 ms-2" style="width: 90%; resize: none;" name="expense_desc" id="expense_desc" cols="30" rows="10" required></textarea><br><br>
          </div>
          <div class="row">
            <label style="color: WHITE; font-size: 26px;" for="expense_amt">Expense Amount:</label>
          </div>
          <div class="row">
            <input class="rounded-3 overflow-hidden mt-2 ms-2" style="width: 90%;" type="number" name="expense_amt" id="expense_amt" required>
          </div>
          <br><br>

          <button class="btn btn-light me-3" onclick="toggleForm('expenses')">Cancel</button>
          <input class="btn me-3" style="background-color: BLACK; color: WHITE;" type="submit">
        </form>
      </div>
    </div>

    <div class="vline"></div>
    <!-- Expenses list -->
    <div id="expensesList">
      <h2  style="color: WHITE;"> 
        Expenses 
        <button id="expensesCreateBtn" class="rounded-5 overflow-hidden" style="width: 24px; height: 24px;" onclick="toggleForm('expenses')"></button>
      </h2>
        <div class="mb-3" style="height: 1px; width: 93%; background-color: #EAEFF5"></div>
        <!-- line break --> 
          {% for expense in expenses %}
            <table class="table table-success rounded-3 overflow-hidden" style="width:93%;">
              <tr>
                <th> {{ expense.expense_desc}} </th>
                <td class="table table-light p-0" style="width:80%">
                  <table style="text-align: left" class="table table-light mb-0">
                    <tr>
                      <td><i>Expense by:</i> <b>{{ expense.member.user.name }}</b></td>
                    </tr>
                    <tr>
                      <td><i>Amount:</i> <b>PHP {{ expense.expense_amt }}</b></td>
                    </tr>
                    <tr class="removeBottomBorder">
                      <td class="removeBottomBorder"><i>Date:</i> <b>{{ expense.expense_date }}</b></td>
                    </tr>
                  </table>
                </td>
              </tr>
            </table>
          {% endfor %}
    </div>


{% endblock %}
